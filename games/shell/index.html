<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Shell Game - The Dak and Chog Tavern</title>
  <link rel="stylesheet" href="../../css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="ShellABI.js"></script> <!-- ABI loaded as global -->
  <script type="module" src="../../js/tavern.js"></script>
  <style>
    /* Override page background for Shell */
    body {
      /* Centered, then nudged down slightly from center */
      background: url('../../assets/images/shell-bg.png') no-repeat 50% calc(50% + 5vh) fixed;
      background-size: cover;
    }
    /* Game page logo at top */
    .game-logo {
      display:block;
      height:auto;
      max-width: clamp(220px, 40vw, 560px);
      /* overlap and center over the container */
      position:absolute; left:50%; top:0; z-index:3;
      transform: translate(-50%, -50%) scale(0.85);
      transform-origin: top center;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,0.25));
      pointer-events:none; user-select:none;
    }
    /* add breathing room so content sits below the overlapped logo */
    .tavern { padding-top: clamp(120px, 18vw, 200px); }
    @media (max-width: 600px) {
      .game-logo { transform: translate(-50%, -50%) scale(0.8); }
      .tavern { padding-top: clamp(110px, 24vw, 180px); }
    }
    /* Decorative hovering cup (base: bottom-left) */
    .decor-cup {
      position:absolute; left:0; bottom:0;
      /* place the image center roughly over the corner */
      --tx:-42%; --ty:42%; --rot:-8deg; --par:0px;
      /* subtle oscillation + bob controls */
      --rotAmp: 1.2deg;   /* tiny wiggle */
      --bobOffset: -6%;   /* gentle vertical drift amplitude */
      --bobDur: 3.85s;    /* timing tuned to feel natural */
      --bobDelay: .06s;   /* slight phase offset */
      transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot));
      width:clamp(80px, 12vw, 160px);
      height:auto;
      pointer-events:none; user-select:none;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,0.25));
      z-index: 2;
      animation-name: decor-bob;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-duration: var(--bobDur);
      animation-delay: var(--bobDelay);
    }
    /* Corner variants with small positional/animation offsets */
    .decor-top-left { top:0; bottom:auto; left:0; right:auto; --tx:-44%; --ty:-40%; --rot:8deg;   --rotAmp:1.6deg; --bobOffset: 6%;  --bobDur:3.7s; --bobDelay:.08s; }
    .decor-top-right { top:0; bottom:auto; right:0; left:auto; --tx: 40%; --ty:-44%; --rot:-10deg; --rotAmp:1.8deg; --bobOffset: 5.5%; --bobDur:3.95s; --bobDelay:.12s; }
    .decor-bottom-right { bottom:0; top:auto; right:0; left:auto; --tx: 44%; --ty: 40%; --rot:10deg;  --rotAmp:1.4deg; --bobOffset:-5%;  --bobDur:4.05s; --bobDelay:.05s; }
    @keyframes decor-bob {
      0%   { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot)); }
      25%  { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(calc(var(--rot) + var(--rotAmp))); }
      50%  { transform: translate(var(--tx), calc(var(--ty) + var(--par) + var(--bobOffset))) rotate(var(--rot)); }
      75%  { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(calc(var(--rot) - var(--rotAmp))); }
      100% { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot)); }
    }
  </style>
</head>
<body class="game">
  <div class="top-banner" role="region" aria-label="Wallet and status">
    <div class="banner-left">
      <button id="return" class="return-btn">Return to Tavern</button>
      <div id="status" class="banner-status"></div>
    </div>
    <div class="banner-right">
      <div class="controls">
        <button id="connect-wallet">Connect Wallet</button>
        <button id="fund-contract" style="display:none;">Fund Game Contracts</button>
      </div>
    </div>
  </div>
  <div class="tavern" style="position:relative; margin:clamp(180px, 14vw, 300px) auto 28px;">
    <h1 class="visually-hidden">Shell Game</h1>
    <img class="game-logo" src="../../assets/images/shell-game-logo.png" alt="Shell Game">
    <p>Click a shell, place your bet, and test your luck!</p>

    <label>Bet Amount (MON):</label>
    <input id="bet" type="number" min="0.001" step="0.001" value="0.01"><br>

    <div class="shells" aria-label="Choose a shell">
      <div class="shell" role="button" tabindex="0" aria-label="Left shell" data-guess="0"></div>
      <div class="shell" role="button" tabindex="0" aria-label="Center shell" data-guess="1"></div>
      <div class="shell" role="button" tabindex="0" aria-label="Right shell" data-guess="2"></div>
    </div>
    <div style="margin:8px 0;">
      <label style="font-size:13px;">
        <input id="toggle-animations" type="checkbox" checked>
        Animations
      </label>
    </div>

    <div id="status"></div>

    <div class="scoreboard">
      <h3>Recent Plays</h3>
      <ul id="plays"></ul>
    </div>
    <img src="../../assets/images/cup2.png" alt="" aria-hidden="true" class="decor-cup">
    <img src="../../assets/images/cup.png" alt="" aria-hidden="true" class="decor-cup decor-bottom-right">
    <img src="../../assets/images/cup.png" alt="" aria-hidden="true" class="decor-cup decor-top-left">
    <img src="../../assets/images/cup2.png" alt="" aria-hidden="true" class="decor-cup decor-top-right">
  </div>

  <script type="module" src="shell.js"></script>
  <script>
    // Parallax drift for all decorative cups
    (function(){
      const els = document.querySelectorAll('.decor-cup');
      if (!els.length) return;
      const onScroll = () => {
        const y = Math.max(0, window.scrollY) * 0.06; // gentle drift
        els.forEach(el => el.style.setProperty('--par', y + 'px'));
      };
      window.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    })();
  </script>
</body>
</html>
