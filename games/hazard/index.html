<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hazard - Dak & Chog Tavern</title>
  <link rel="stylesheet" href="../../css/style.css">

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="../../js/TavernABI.js"></script>
  <script type="module" src="../../js/tavern.js"></script>

  <style>
    .dice-row { display:flex; justify-content:center; gap:16px; margin:18px 0; }
    .dice {
      width:clamp(84px, 12vw, 140px); height:clamp(84px, 12vw, 140px);
      display:flex; align-items:center; justify-content:center;
      font-size:clamp(36px, 6vw, 56px); border-radius:12px; background: rgba(255,255,255,0.06);
      box-shadow: inset 0 2px 0 rgba(255,255,255,0.03);
    }
    .dice.shake { animation: shake 0.6s ease; }
    @keyframes shake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(-18deg); }
      50% { transform: rotate(18deg); }
      75% { transform: rotate(-8deg); }
      100% { transform: rotate(0deg); }
    }

    .controls { display:flex; gap:12px; align-items:center; justify-content:center; margin-bottom:12px; }
    .rules { font-size:10.4px; color:#2b1e12; text-align:left; background: rgba(255,255,255,0.06); padding:10px; border-radius:8px; margin:12px auto; width:90%; max-width:720px; }
    .main-select button {
      margin-right:6px;
      cursor:pointer;
      transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
      background: url('../../assets/images/nav-gem.png') no-repeat center / 100% 100%;
      border: none;
      color: #fff;
      font-weight: 700;
      font-family: 'Morris', 'Morris Alt', serif;
      text-shadow: 0 1px 2px rgba(0,0,0,0.45);
      height: 2.6em; /* gem height ~2.6x font */
      padding: 0 16px; /* extend 16px beyond text on each side */
      border-radius: 10px; /* keep hit area smooth */
    }
    .main-select button:hover { transform: translateY(-1px); filter: drop-shadow(0 4px 10px rgba(0,0,0,0.25)); }
    .main-select button.active {
      color:white;
      box-shadow:0 0 0 2px #7800cd, 0 6px 18px rgba(120,0,205,0.35);
      transform: translateY(-1px) scale(1.05);
    }
    /* Primary/Accent buttons for Hazard */
    #roll-dice { background:#9200fa; color:#fff; border:none; border-radius:10px; box-shadow:0 6px 18px rgba(146,0,250,0.35); transition: transform .12s ease, box-shadow .12s ease, background .12s ease; }
    #roll-dice:hover { background:#7800cd; box-shadow:0 6px 22px rgba(120,0,205,0.45); transform: translateY(-1px); }
    #roll-dice:disabled { opacity:.65; cursor:not-allowed; transform:none; box-shadow:none; }
    /* Decorative hovering dice anchored to corners */
    .decor-die {
      position:absolute;
      /* defaults for bottom-left; overridden by corner modifiers */
      left:0; bottom:0;
      --tx:-42%; --ty:42%; --rot:-6deg; --par:0px;
      /* bob tuning (defaults) */
      --bobOffset:-6%; /* negative lifts bottom corners a bit */
      --bobDur:3.8s;   /* subtle variation per-corner below */
      --bobDelay:0s;
      transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot));
      width:clamp(80px, 12vw, 160px);
      height:auto;
      pointer-events:none; user-select:none;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,0.25));
      z-index: 2;
      animation-name: decor-bob;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-duration: var(--bobDur);
      animation-delay: var(--bobDelay);
    }
    .decor-top-left { top:0; bottom:auto; left:0; right:auto; --tx:-42%; --ty:-42%; --rot:8deg;  --bobOffset:6%;  --bobDur:3.7s; --bobDelay:.08s; }
    .decor-top-right { top:0; bottom:auto; right:0; left:auto; --tx:42%;  --ty:-42%; --rot:-12deg; --bobOffset:5.5%; --bobDur:3.9s; --bobDelay:.12s; }
    .decor-bottom-right { bottom:0; top:auto; right:0; left:auto; --tx:42%;  --ty:42%;  --rot:10deg; --bobOffset:-5%; --bobDur:4.0s; --bobDelay:.05s; }
    @keyframes decor-bob {
      0%, 100% { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot)); }
      50% { transform: translate(var(--tx), calc(var(--ty) + var(--par) + var(--bobOffset))) rotate(var(--rot)); }
    }
    /* Override page background for Hazard */
    body {
      background: url('../../assets/images/hazard-bg.png') no-repeat center center fixed;
      background-size: cover;
    }

    /* Game page logo at top */
    .game-logo {
      display:block;
      height:auto;
      max-width: clamp(220px, 40vw, 560px);
      /* overlap and center over the container */
      position:absolute; left:50%; top:0; z-index:3;
      transform: translate(-50%, -50%) scale(0.85);
      transform-origin: top center;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,0.25));
      pointer-events:none; user-select:none;
    }
    /* add breathing room so content sits below the overlapped logo */
    .tavern { padding-top: clamp(120px, 18vw, 200px); }
    @media (max-width: 600px) {
      .game-logo { transform: translate(-50%, -50%) scale(0.8); }
      .tavern { padding-top: clamp(110px, 24vw, 180px); }
    }

    /* Center game assets now that rules are in modal */
    .hazard-layout { display:flex; flex-direction:column; gap:16px; align-items:center; justify-content:center; }
    .hazard-left { display:none; }
    .hazard-right { flex:0 0 auto; min-width:auto; width:100%; max-width:820px; margin:0 auto; }
    @media (max-width: 900px) {
      .hazard-layout { flex-direction:column; }
      .hazard-left { max-width:100%; }
    }
    /* Subtle per-corner oscillation and timing overrides */
    .decor-die {
      --rotAmp: 1deg;
      --bobOffset: -6%;
      --bobDur: 3.8s;
      --bobDelay: 0s;
      animation-name: decor-bob;
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      animation-duration: var(--bobDur);
      animation-delay: var(--bobDelay);
    }
    .decor-top-left    { --tx:-44%; --ty:-40%; --rotAmp:1.6deg; --bobOffset: 6%;  --bobDur:3.7s; --bobDelay:.08s; }
    .decor-top-right   { --tx: 40%; --ty:-44%; --rotAmp:1.8deg; --bobOffset: 5.5%; --bobDur:3.9s; --bobDelay:.12s; }
    .decor-bottom-right{ --tx: 44%; --ty: 40%; --rotAmp:1.4deg; --bobOffset:-5%;  --bobDur:4.0s; --bobDelay:.05s; }

    @keyframes decor-bob {
      0%   { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot)); }
      25%  { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(calc(var(--rot) + var(--rotAmp))); }
      50%  { transform: translate(var(--tx), calc(var(--ty) + var(--par) + var(--bobOffset))) rotate(var(--rot)); }
      75%  { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(calc(var(--rot) - var(--rotAmp))); }
      100% { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot)); }
    }
  </style>
  </head>
<body class="game">
  <div id="rules-overlay" style="position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:9999;">
    <div style="background:rgba(255,244,233,0.96); border:4px solid #7800cd; border-radius:12px; padding:16px; width:min(92vw, 820px); max-height:90vh; overflow:auto; text-align:left; color:#2b1e12;">
      <h2 style="margin-top:0;">Hazard Rules</h2>
      <ul>
        <li>Choose a main (5â€“9) and place your bet.</li>
        <li>First coup reveals two cards (dice): bank card then player card.</li>
        <li>If first total equals your main: you win immediately.</li>
        <li>If first total is 2 or 3: you lose immediately.</li>
        <li>If first total is 11 or 12: special main-dependent result.</li>
        <li>Otherwise, the total becomes the chance; roll until chance or main resolves.</li>
        <li>Payout on win attempts to pay 2x wager (requires bankroll).</li>
      </ul>
      <button id="rules-ack" style="margin-top:8px;">I have read and understand</button>
    </div>
  </div>
  <div class="top-banner" role="region" aria-label="Wallet and status">
    <div class="banner-left">
      <button id="return" class="return-btn">Return to Tavern</button>
      <div id="status" class="banner-status"></div>
    </div>
    <div class="banner-right">
      <div class="controls">
        <button id="connect-wallet">Connect Wallet</button>
      </div>
    </div>
  </div>
  <div class="tavern" style="max-width:1280px; width:95%; margin:clamp(180px, 14vw, 300px) auto 28px; position:relative;">
    <h1 class="visually-hidden">Hazard</h1>
    <img class="game-logo" src="../../assets/images/hazard-logo.png" alt="Hazard">
    <div style="text-align:center; margin-top:6px;">
      <button id="open-rules">Rules</button>
    </div>
    <div class="hazard-layout">
      <aside class="hazard-left"></aside>

      <section class="hazard-right">
        <div class="controls">
          <div class="main-select" aria-label="Choose main">
            <label>Main:</label>
            <button data-main="5">5</button>
            <button data-main="6">6</button>
            <button data-main="7" class="active">7</button>
            <button data-main="8">8</button>
            <button data-main="9">9</button>
          </div>

          <div>
            <label>Bet (MON)</label><br>
            <input id="bet" type="number" min="0.001" step="0.001" value="0.01" style="width:110px; text-align:center;">
          </div>
        </div>

        <div class="dice-row">
          <div id="dice1" class="dice">?</div>
          <div id="dice2" class="dice">?</div>
        </div>

        <div style="text-align:center; margin-bottom:12px;">
          <button id="roll-dice" style="padding:10px 18px; font-size:16px;">Roll Dice</button>
        </div>

        <div id="status" style="min-height:28px; text-align:center;"></div>

        <div class="scoreboard" style="margin-top:18px;">
          <h3>Recent Rolls</h3>
          <ul id="rolls"></ul>
        </div>
      </section>
    </div>

    <img src="../../assets/images/dice/standard/dice1.png" alt="" aria-hidden="true" class="decor-die">
    <img src="../../assets/images/dice/standard/dice2.png" alt="" aria-hidden="true" class="decor-die decor-bottom-right">
    <img src="../../assets/images/dice/standard/dice3.png" alt="" aria-hidden="true" class="decor-die decor-top-left">
    <img src="../../assets/images/dice/standard/dice4.png" alt="" aria-hidden="true" class="decor-die decor-top-right">
  </div>

  <script type="module" src="hazard.js"></script>
  <script>
    // Parallax drift for all decorative dice
    (function(){
      const els = document.querySelectorAll('.decor-die');
      if (!els.length) return;
      const onScroll = () => {
        const y = Math.max(0, window.scrollY) * 0.06; // gentle drift
        els.forEach(el => el.style.setProperty('--par', y + 'px'));
      };
      window.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    })();
  </script>
</body>
</html>
