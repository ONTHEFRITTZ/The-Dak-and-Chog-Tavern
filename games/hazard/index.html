<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hazard - Dak & Chog Tavern</title>
  <link rel="stylesheet" href="../../css/style.css">

  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="HazardABI.js"></script>

  <style>
    .dice-row { display:flex; justify-content:center; gap:16px; margin:18px 0; }
    .dice {
      width:clamp(84px, 12vw, 140px); height:clamp(84px, 12vw, 140px);
      display:flex; align-items:center; justify-content:center;
      font-size:clamp(36px, 6vw, 56px); border-radius:12px; background: rgba(255,255,255,0.06);
      box-shadow: inset 0 2px 0 rgba(255,255,255,0.03);
    }
    .dice.shake { animation: shake 0.6s ease; }
    @keyframes shake {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(-18deg); }
      50% { transform: rotate(18deg); }
      75% { transform: rotate(-8deg); }
      100% { transform: rotate(0deg); }
    }

    .controls { display:flex; gap:12px; align-items:center; justify-content:center; margin-bottom:12px; }
    .rules { font-size:13px; color:#2b1e12; text-align:left; background: rgba(255,255,255,0.06); padding:10px; border-radius:8px; margin:12px auto; width:90%; max-width:720px; }
    .main-select button { padding:8px 12px; margin-right:6px; border-radius:8px; cursor:pointer; transition: transform .12s ease, box-shadow .12s ease, background .12s ease; }
    .main-select button.active { background:#7800cd; color:white; box-shadow:0 0 0 2px #7800cd, 0 6px 18px rgba(120,0,205,0.35); transform: translateY(-1px) scale(1.05); }
    /* Primary/Accent buttons for Hazard */
    #roll-dice { background:#9200fa; color:#fff; border:none; border-radius:10px; box-shadow:0 6px 18px rgba(146,0,250,0.35); transition: transform .12s ease, box-shadow .12s ease, background .12s ease; }
    #roll-dice:hover { background:#7800cd; box-shadow:0 6px 22px rgba(120,0,205,0.45); transform: translateY(-1px); }
    #roll-dice:disabled { opacity:.65; cursor:not-allowed; transform:none; box-shadow:none; }
    /* Decorative hovering die over bottom-left corner */
    .decor-die {
      position:absolute; left:0; bottom:0;
      --tx:-42%; --ty:42%; --rot:-6deg; --par:0px;
      transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot));
      width:clamp(80px, 12vw, 160px);
      height:auto;
      pointer-events:none; user-select:none;
      filter: drop-shadow(0 6px 16px rgba(0,0,0,0.25));
      z-index: 2;
      animation: decor-bob 3.8s ease-in-out infinite;
    }
    @keyframes decor-bob {
      0%, 100% { transform: translate(var(--tx), calc(var(--ty) + var(--par))) rotate(var(--rot)); }
      50% { transform: translate(var(--tx), calc(var(--ty) - 6% + var(--par))) rotate(var(--rot)); }
    }
    /* Override page background for Hazard */
    body {
      background: url('../../assets/images/hazard-bg.png') no-repeat center center fixed;
      background-size: cover;
    }

    /* Two-column layout: rules on the left */
    .hazard-layout { display:flex; gap:16px; align-items:flex-start; justify-content:center; }
    .hazard-left { flex:0 0 380px; max-width:420px; }
    .hazard-right { flex:1 1 0; min-width:0; }
    .hazard-left .rules { width:auto; max-width:none; font-size:25px; }
    .hazard-left .rules ol { margin-left:18px; }
    .hazard-left .rules li { margin:6px 0; }
    @media (max-width: 900px) {
      .hazard-layout { flex-direction:column; }
      .hazard-left { max-width:100%; }
    }
  </style>
  </head>
<body>
  <div class="tavern" style="max-width:1280px; width:95%; margin:28px auto; position:relative;">
    <h1>Hazard</h1>
    <div class="hazard-layout">
      <aside class="hazard-left">
        <div class="rules" style="text-align:left; background: rgba(255,255,255,0.06); padding:12px; border-radius:8px;">
          <strong>Rules (contract):</strong>
          <ol>
            <li>Choose a <em>main</em> between <strong>5</strong> and <strong>9</strong>.</li>
            <li>Place a wager and click <strong>Roll Dice</strong>. The contract rolls two dice until a result is reached.</li>
            <li>First roll:
              <ul>
                <li>If roll equals your main: immediate win.</li>
                <li>If roll is 2 or 3: immediate loss.</li>
                <li>If roll is 11 or 12: win if main is 5 or 9; lose if main is 7; otherwise lose.</li>
                <li>Otherwise the roll becomes the <em>chance</em> (a point) and subsequent rolls repeat until the chance or main resolves the game.</li>
              </ul>
            </li>
            <li>If you win, the contract attempts to pay 2x your wager (contract must have bankroll).</li>
          </ol>
        </div>
      </aside>

      <section class="hazard-right">
        <div class="controls">
          <div class="main-select" aria-label="Choose main">
            <label>Main:</label>
            <button data-main="5">5</button>
            <button data-main="6">6</button>
            <button data-main="7" class="active">7</button>
            <button data-main="8">8</button>
            <button data-main="9">9</button>
          </div>

          <div>
            <label>Bet (MON)</label><br>
            <input id="bet" type="number" min="0.001" step="0.001" value="0.01" style="width:110px; text-align:center;">
          </div>
        </div>

        <div class="dice-row">
          <div id="dice1" class="dice">?</div>
          <div id="dice2" class="dice">?</div>
        </div>

        <div style="text-align:center; margin-bottom:12px;">
          <button id="roll-dice" style="padding:10px 18px; font-size:16px;">Roll Dice</button>
        </div>

        <div id="status" style="min-height:28px; text-align:center;"></div>

        <div style="text-align:center; margin-top:10px;">
          <button id="return">Return to Tavern</button>
        </div>

        <div class="scoreboard" style="margin-top:18px;">
          <h3>Recent Rolls</h3>
          <ul id="rolls"></ul>
        </div>
      </section>
    </div>

    <img src="../../assets/images/dice1-standard.png" alt="" aria-hidden="true" class="decor-die">
  </div>

  <script type="module" src="hazard.js"></script>
  <script>
    // Parallax drift for decorative die
    (function(){
      const el = document.querySelector('.decor-die');
      if (!el) return;
      const onScroll = () => {
        const y = Math.max(0, window.scrollY) * 0.06; // gentle drift
        el.style.setProperty('--par', y + 'px');
      };
      window.addEventListener('scroll', onScroll, { passive: true });
      onScroll();
    })();
  </script>
</body>
</html>
